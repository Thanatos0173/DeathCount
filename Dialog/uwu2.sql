DO $$ DECLARE posid INT; moveid INT; result INT; BEGIN SELECT id INTO posid FROM positions WHERE position = '0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111100000001111111111111110000011111111111111100000111111111111111000001111111111111110000011111111111111100000111111111111111000001111111111111110000000000000000000000000000000000000000' LIMIT 1; SELECT id INTO moveid FROM moves WHERE move = '0100000' LIMIT 1; SELECT COALESCE( (SELECT ms.occurence FROM movessaving as ms WHERE ms.moveid = moveid AND ms.positionid = posid AND ms.userid = 0 LIMIT 1), 0) INTO result; IF result = 0 THEN INSERT INTO movessaving VALUES (moveid, posid, 0, 1); ELSE UPDATE movessaving as ms SET ms.occurence = result + 1 WHERE ms.moveid = moveid AND ms.positionid = posid AND ms.userid = 0; END IF; END$$;